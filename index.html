<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Lyra AI • Neural Interface</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #030303;
  --accent: #3b82f6; 
  --accent-glow: rgba(59, 130, 246, 0.4);
  --glass: rgba(255, 255, 255, 0.02);
  --glass-border: rgba(255, 255, 255, 0.08);
  --text-main: #ffffff;
  --text-dim: #94a3b8;
}

* { box-sizing: border-box; transition: all 0.2s ease; }

body {
  margin: 0; padding: 0; height: 100dvh;
  background: radial-gradient(circle at 50% -20%, #1e293b, var(--bg) 80%);
  color: var(--text-main); font-family: 'Plus Jakarta Sans', sans-serif;
  display: flex; justify-content: center; align-items: center; overflow: hidden;
}

.app-container {
  width: 100%; height: 100%; background: var(--glass);
  backdrop-filter: blur(30px); display: flex; flex-direction: column;
  position: relative; overflow: hidden;
}

@media (min-width: 768px) {
  .app-container {
    width: 95vw; max-width: 1000px; height: 90vh;
    border: 1px solid var(--glass-border); border-radius: 32px;
  }
}

.neon-title-bg {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  z-index: 1; text-align: center; pointer-events: none; width: 100%; opacity: 0.2;
}

.neon-title-bg h1 {
  font-size: clamp(40px, 15vw, 120px); font-weight: 800; margin: 0;
  color: transparent; -webkit-text-stroke: 1.5px rgba(59, 130, 246, 0.5);
  text-shadow: 0 0 30px var(--accent-glow);
}

.header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 15px; background: rgba(0,0,0,0.6);
  border-bottom: 1px solid var(--glass-border); z-index: 10;
}

.header img { width: 30px; height: 30px; border-radius: 8px; border: 1px solid var(--accent); }

.chat {
  flex: 1; padding: 15px; overflow-y: auto; z-index: 5;
  display: flex; flex-direction: column; background: transparent;
}

.message { display: flex; gap: 10px; margin-bottom: 20px; z-index: 6; animation: slideUp 0.3s ease; }
.message.user { flex-direction: row-reverse; }
.avatar { width: 32px; height: 32px; border-radius: 8px; flex-shrink: 0; border: 1px solid var(--glass-border); }
.msg-content { display: flex; flex-direction: column; max-width: 80%; }
.message.user .msg-content { align-items: flex-end; }
.sender-name { font-size: 10px; font-weight: 800; color: var(--text-dim); margin-bottom: 4px; }
.bubble { padding: 10px 14px; border-radius: 16px; font-size: 14px; line-height: 1.5; word-wrap: break-word; }
.user .bubble { background: var(--accent); border-top-right-radius: 4px; box-shadow: 0 4px 15px var(--accent-glow); }
.bot .bubble { background: rgba(255,255,255,0.08); border: 1px solid var(--glass-border); border-top-left-radius: 4px; backdrop-filter: blur(5px); }

.msg-meta { font-size: 8px; color: var(--text-dim); margin-top: 4px; font-weight: 600; }

#typing-indicator { display: none; font-size: 11px; color: var(--accent); padding: 0 20px 10px; font-weight: 700; }

.input-area { padding: 12px; background: rgba(0,0,0,0.8); border-top: 1px solid var(--glass-border); z-index: 20; }
.input-wrapper { display: flex; background: rgba(255,255,255,0.07); border: 1px solid var(--glass-border); border-radius: 15px; padding: 4px; align-items: center; width: 100%; }

/* Style Dropdown */
.controls-group { display: flex; flex-shrink: 0; }
select { background: #111; color: var(--text-dim); border: none; padding: 8px; font-size: 10px; outline: none; border-right: 1px solid var(--glass-border); width: 75px; flex-shrink: 0; }
#provider { border-radius: 12px 0 0 12px; }
#voiceMode { width: 85px; }

input { flex: 1; background: transparent; border: none; color: white; padding: 10px; font-size: 14px; outline: none; min-width: 0; }
#sendBtn { background: var(--accent); border: none; color: white; padding: 8px 15px; border-radius: 12px; font-weight: 800; font-size: 12px; cursor: pointer; flex-shrink: 0; }

@keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<div class="app-container">
  <div class="neon-title-bg"><h1>LYRA AI</h1></div>

  <div class="header">
    <div style="display:flex; align-items:center; gap:8px;">
      <img src="https://i.pinimg.com/736x/7d/43/5a/7d435a92133c1c27c802183f7213d7df.jpg">
      <div><strong>Lyra AI</strong><br><span style="font-size:8px; color:var(--accent);">ACTIVE SESSION</span></div>
    </div>
    <button style="background:transparent; color:var(--text-dim); border:1px solid var(--glass-border); border-radius:6px; font-size:9px; padding:4px 8px;" onclick="clearChat()">Reset</button>
  </div>

  <div class="chat" id="chat"></div>
  <div id="typing-indicator">Lyra is thinking...</div>
  
  <div class="input-area">
    <div class="input-wrapper">
      <div class="controls-group">
        <select id="provider">
          <option value="groq_primary">Groq 1</option>
          <option value="groq_backup">Groq 2</option>
          <option value="gemini">Gemini</option>
          <option value="openrouter">OpenR</option>
        </select>
        <select id="voiceMode">
          <option value="off">Teks Saja</option>
          <option value="on">Suara On</option>
        </select>
      </div>
      <input id="input" placeholder="Message..." autocomplete="off">
      <button id="sendBtn" onclick="send()">SEND</button>
    </div>
  </div>
</div>

<script>
marked.setOptions({ breaks: true });
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");
const providerSelect = document.getElementById("provider");
const voiceSelect = document.getElementById("voiceMode");
const typingIndicator = document.getElementById("typing-indicator");

const WEBHOOK_URL = "https://navly.app.n8n.cloud/webhook-test/chat";

function speak(text) {
  if (voiceSelect.value === "off") return;
  
  const cleanText = text.replace(/[#*`_]/g, "").replace(/<[^>]*>?/gm, "");
  const utterance = new SpeechSynthesisUtterance(cleanText);
  utterance.lang = 'id-ID';
  utterance.pitch = 1.1;
  utterance.rate = 1.0;
  
  window.speechSynthesis.speak(utterance);
}

function addMessage(text, type, modelName = null) {
  const msg = document.createElement("div");
  msg.className = "message " + type;
  const avatarSrc = type === "user" ? "https://i.pinimg.com/736x/2e/1c/f7/2e1cf728ab26ddd8bce93c7c4423389f.jpg" : "https://i.pinimg.com/736x/7d/43/5a/7d435a92133c1c27c802183f7213d7df.jpg";
  
  const now = new Date();
  const timeStr = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');

  msg.innerHTML = `
    <img src="${avatarSrc}" class="avatar">
    <div class="msg-content">
      <span class="sender-name">${type === 'user' ? 'Navaro' : 'Lyra'}</span>
      <div class="bubble">${type === 'bot' ? marked.parse(text) : text}</div>
      <div class="msg-meta">${timeStr} ${modelName ? `• ${modelName}` : ''}</div>
    </div>
  `;
  
  if(type === "user") msg.style.flexDirection = "row-reverse";
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;

  if(type === "bot") speak(text);
}

async function send() {
  const text = input.value.trim();
  if (!text) return;
  const provider = providerSelect.value;
  
  const currentTimeContext = new Date().toLocaleString('id-ID', { 
    weekday: 'long', day: 'numeric', month: 'long', year: 'numeric', 
    hour: '2-digit', minute: '2-digit', timeZone: 'Asia/Jakarta' 
  });

  input.disabled = true; sendBtn.disabled = true;
  addMessage(text, "user");
  input.value = "";
  typingIndicator.style.display = "block";
  window.speechSynthesis.cancel();

  try {
    const res = await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ 
        message: text, 
        provider: provider,
        current_time: currentTimeContext 
      })
    });
    const data = await res.json();
    addMessage(data.response || data.output || "Offline", "bot", data.model_used || provider);
  } catch (e) {
    addMessage("Error koneksi...", "bot");
  } finally {
    typingIndicator.style.display = "none";
    input.disabled = false; sendBtn.disabled = false; input.focus();
  }
}

function clearChat() { if(confirm("Reset?")) { chat.innerHTML = ""; location.reload(); } }
input.addEventListener("keydown", e => { if (e.key === "Enter" && !input.disabled) send(); });
</script>
</body>
</html>
