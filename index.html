<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Lyra AI â€¢ Neural Interface</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root {
  /* TEMA DEEP MIDNIGHT */
  --bg: #0b0e14; 
  --accent: #3b82f6; 
  --accent-glow: rgba(59, 130, 246, 0.4);
  --glass: rgba(15, 23, 42, 0.6); 
  --glass-border: rgba(59, 130, 246, 0.3);
  --text-main: #e2e8f0; 
  --text-dim: #94a3b8;
}

[data-theme="night"] {
  --bg: #0f0a1a; 
  --accent: #8b5cf6;
  --accent-glow: rgba(139, 92, 246, 0.4);
  --glass-border: rgba(139, 92, 246, 0.4);
}

* { box-sizing: border-box; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

body {
  margin: 0; padding: 0; height: 100dvh;
  background: radial-gradient(circle at 50% 50%, #1e293b 0%, var(--bg) 100%);
  color: var(--text-main); font-family: 'Plus Jakarta Sans', sans-serif;
  display: flex; justify-content: center; align-items: center; overflow: hidden;
}

/* ORB ANIMATION */
.orb-container {
  position: fixed; width: 100vw; height: 100vh; z-index: -1; overflow: hidden; filter: blur(80px);
}
.orb {
  position: absolute; border-radius: 50%; opacity: 0.4; animation: move 20s infinite alternate;
}
.orb-1 { width: 400px; height: 400px; background: var(--accent-glow); top: -10%; left: -10%; }
.orb-2 { width: 300px; height: 300px; background: #4f46e5; bottom: -5%; right: -5%; animation-delay: -5s; }
@keyframes move {
  0% { transform: translate(0, 0) scale(1); }
  100% { transform: translate(100px, 50px) scale(1.2); }
}

.app-container {
  width: 100%; height: 100%; background: var(--glass);
  backdrop-filter: blur(25px); display: flex; flex-direction: column;
  position: relative; overflow: hidden;
  border: 1.5px solid var(--accent);
  box-shadow: 0 0 30px var(--accent-glow);
}

@media (min-width: 768px) {
  .app-container { width: 95vw; max-width: 1000px; height: 90vh; border-radius: 32px; }
}

/* GLITCH TITLE */
.neon-title-bg {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  z-index: 0; text-align: center; pointer-events: none; width: 100%;
}
.glitch {
  font-size: clamp(60px, 20vw, 160px); font-weight: 900; margin: 0;
  color: white; opacity: 0.2; letter-spacing: -2px; position: relative;
  text-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent-glow);
  animation: float 6s ease-in-out infinite;
}
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

.header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 15px; background: rgba(15, 23, 42, 0.8); border-bottom: 1.5px solid var(--accent); z-index: 10;
}

/* STATS BAR */
.stats-bar {
  padding: 8px 20px; display: flex; gap: 15px; background: rgba(15, 23, 42, 0.6); 
  border-bottom: 1px solid var(--glass-border); z-index: 10; align-items: center;
}
.stat-item { font-size: 9px; font-weight: 800; letter-spacing: 1px; color: var(--text-dim); display: flex; align-items: center; gap: 5px; }
.stat-value { color: var(--accent); text-transform: uppercase; text-shadow: 0 0 5px var(--accent); }
.progress-bg { width: 60px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; }
.progress-fill { height: 100%; background: var(--accent); box-shadow: 0 0 8px var(--accent); }

.chat { flex: 1; padding: 20px; overflow-y: auto; z-index: 5; display: flex; flex-direction: column; gap: 12px; }

.message { display: flex; gap: 10px; width: 100%; z-index: 6; }
.message.bot { align-items: flex-start; }
.message.user { justify-content: flex-end; align-items: flex-start; }

.chat-avatar { width: 32px; height: 32px; border-radius: 8px; border: 1.5px solid var(--accent); object-fit: cover; }
.msg-content { display: flex; flex-direction: column; max-width: 80%; }

.msg-author { font-size: 10px; font-weight: 800; color: var(--accent); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
.user .msg-author { align-self: flex-end; color: #fff; opacity: 0.7; }

.bubble { padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.6; white-space: pre-wrap; position: relative; }
.bot .bubble { background: rgba(255,255,255,0.06); border: 1px solid var(--glass-border); border-top-left-radius: 2px; backdrop-filter: blur(12px); }
.user .bubble { background: var(--accent); border-top-right-radius: 2px; box-shadow: 0 5px 15px var(--accent-glow); color: white; }

/* PERBAIKAN: Menghapus glow pada bold agar papan tidak berantakan */
.bubble b, .bubble strong {
  color: inherit;
  font-weight: 800;
  text-shadow: none; /* Glow dihapus di sini */
}

.sticker-img { max-width: 180px; border-radius: 12px; display: block; margin-top: 5px; border: 1px solid var(--glass-border); }

#typing-indicator { display: none; font-size: 10px; font-weight: 800; color: var(--accent); padding: 0 20px 10px; text-transform: uppercase; letter-spacing: 2px; animation: pulse 1.5s infinite; }
@keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }

.input-area { background: rgba(15, 23, 42, 0.95); border-top: 1.5px solid var(--accent); z-index: 20; }
.input-wrapper { display: flex; padding: 12px; align-items: center; gap: 8px; }
select { background: #1a2233; color: #fff; border: 1px solid var(--glass-border); padding: 8px; font-size: 10px; border-radius: 10px; outline: none; }

textarea { 
  flex: 1; background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-radius: 14px; 
  color: white; padding: 10px 15px; outline: none; font-size: 14px; resize: none; 
  font-family: inherit; line-height: 1.4; max-height: 150px; overflow-y: hidden;
}

#sendBtn { background: var(--accent); border: none; color: white; padding: 10px 20px; border-radius: 14px; font-weight: 800; cursor: pointer; height: 40px; box-shadow: 0 0 15px var(--accent-glow); }

#status-bar { font-size: 10px; color: var(--accent); font-weight: 800; }
.btn-reset { background: transparent; color: var(--text-dim); border: 1px solid var(--glass-border); padding: 5px 10px; border-radius: 8px; font-size: 9px; font-weight: 700; cursor: pointer; }
</style>
</head>
<body>

<div class="orb-container">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
</div>

<div class="app-container" id="main-frame">
  <div class="neon-title-bg"><h1 class="glitch">LYRA AI</h1></div>

  <div class="header">
    <div style="display:flex; align-items:center; gap:10px;">
      <img src="https://i.pinimg.com/736x/7d/43/5a/7d435a92133c1c27c802183f7213d7df.jpg" width="30" style="border-radius:8px; border: 1.5px solid var(--accent);">
      <div>
        <strong style="font-size:13px;">Lyra Interface</strong><br>
        <span id="status-bar">Syncing...</span>
      </div>
    </div>
    <div style="display:flex; gap:8px;">
        <select id="provider">
            <option value="groq_primary">Groq 1</option>
            <option value="groq_backup">Groq 2</option>
            <option value="openr_primary">OpenR 1</option>
            <option value="openr_backup">OpenR 2</option>
        </select>
        <button class="btn-reset" onclick="location.reload()">RESET</button>
    </div>
  </div>

  <div class="stats-bar">
      <div class="stat-item">MOOD: <span class="stat-value">ðŸ¥° LOVING</span></div>
      <div class="stat-item" style="flex:1; justify-content:flex-end;">
          AFFECTION: 
          <div class="progress-bg"><div class="progress-fill" style="width: 85%;"></div></div>
      </div>
      <div class="stat-item">CORE: <span class="stat-value" style="color:#22c55e;">STABLE</span></div>
  </div>

  <div class="chat" id="chat"></div>
  <div id="typing-indicator">Lyra is thinking...</div>
  
  <div class="input-area">
    <div class="input-wrapper">
      <textarea id="input" placeholder="Tulis pesan... (Shift+Enter untuk baris baru)" autocomplete="off" rows="1"></textarea>
      <button id="sendBtn" onclick="send()">Send</button>
    </div>
  </div>
</div>

<script>
marked.setOptions({ breaks: true, gfm: true });
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const typingIndicator = document.getElementById("typing-indicator");
const mainFrame = document.getElementById("main-frame");
const statusBar = document.getElementById("status-bar");

function syncTime() {
    const now = new Date();
    const hour = now.getHours();
    if (hour >= 18 || hour < 6) mainFrame.setAttribute('data-theme', 'night');
    else mainFrame.removeAttribute('data-theme');
    statusBar.innerText = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
}
setInterval(syncTime, 1000); syncTime();

input.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
});

async function send() {
  const text = input.value.trim();
  if (!text) return;
  addMsg(text, 'user');
  input.value = "";
  input.style.height = 'auto';
  typingIndicator.style.display = "block";
  chat.scrollTop = chat.scrollHeight;

  const timeNow = new Date().toLocaleString('id-ID', { 
    timeZone: 'Asia/Jakarta', weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  try {
    const res = await fetch("https://navly.app.n8n.cloud/webhook/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text, provider: document.getElementById("provider").value, current_time: timeNow })
    });
    const data = await res.json();
    addMsg(data.response || data.output, 'bot');
  } catch (e) {
    addMsg("https://i.pinimg.com/736x/4c/c0/b4/4cc0b42f30db60057377dfd3f15293d2.jpg", 'bot');
  } finally {
    typingIndicator.style.display = "none";
  }
}

function addMsg(text, type) {
  const imgRegex = /(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp|avif|com\/736x\/.*))/gi;
  const match = text.match(imgRegex);
  if (type === 'bot' && match) {
    const cleanText = text.replace(imgRegex, '').trim();
    if (cleanText) renderBubble(cleanText, type, false);
    match.forEach(url => { renderBubble(`<img src="${url}" class="sticker-img">`, type, true); });
  } else {
    renderBubble(text, type, false);
  }
}

function renderBubble(content, type, isSticker) {
  const msgDiv = document.createElement("div");
  msgDiv.className = `message ${type}`;
  const finalContent = (type === 'bot' && !isSticker) ? marked.parse(content) : content;
  msgDiv.innerHTML = `
    ${type === 'bot' ? '<img src="https://i.pinimg.com/736x/7d/43/5a/7d435a92133c1c27c802183f7213d7df.jpg" class="chat-avatar">' : ''}
    <div class="msg-content">
      <span class="msg-author">${type === 'bot' ? 'Lyra AI' : 'Navaro'}</span>
      <div class="bubble" style="${isSticker ? 'background:transparent; border:none; padding:0;' : ''}">${finalContent}</div>
    </div>`;
  chat.appendChild(msgDiv);
  chat.scrollTop = chat.scrollHeight;
}

input.addEventListener("keydown", e => { 
    if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); send(); } 
});
</script>
</body>
</html>
