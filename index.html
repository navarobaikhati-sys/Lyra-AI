<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Lyra AI â€¢ Neural Full Interface</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
:root {
  --bg: #06080c; 
  --accent: #8b5cf6; 
  --accent-glow: rgba(139, 92, 246, 0.3);
  --accent-soft: rgba(139, 92, 246, 0.12);
  --glass: rgba(10, 10, 15, 0.7); 
  --glass-border: rgba(139, 92, 246, 0.2);
  --text-main: #f1f5f9; 
  --text-dim: #64748b;
}

* { box-sizing: border-box; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }

body {
  margin: 0; padding: 0; height: 100vh; width: 100vw;
  background: 
    radial-gradient(circle at 10% 10%, rgba(139, 92, 246, 0.15), transparent 40%),
    radial-gradient(circle at 90% 90%, rgba(59, 130, 246, 0.1), transparent 40%),
    var(--bg);
  color: var(--text-main); font-family: 'Plus Jakarta Sans', sans-serif;
  display: flex; overflow: hidden; position: relative;
}

body::after {
  content: ""; position: fixed; inset: 0; pointer-events: none;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency=".9" numOctaves="2"/></filter><rect width="120" height="120" filter="url(%23n)" opacity=".04"/></svg>');
  z-index: 99; opacity: 0.5;
}

.neon-title-bg { 
  position: absolute; top: 50%; left: 50%; 
  transform: translate(-50%, -50%); 
  z-index: 1; pointer-events: none;
  width: 100%; text-align: center;
}

.glitch { 
  font-size: clamp(40px, 15vw, 180px); 
  font-weight: 900; color: white; 
  opacity: 0.05; letter-spacing: -2px;
  animation: float 6s infinite ease-in-out;
  white-space: nowrap;
}

@keyframes float { 50% { transform: translateY(-20px); opacity: 0.08; } }

.main-interface {
  flex: 1; display: flex; flex-direction: column; height: 100vh; position: relative; z-index: 10;
}

.header { 
  padding: 15px 20px; background: rgba(10, 10, 15, 0.85); 
  backdrop-filter: blur(25px); border-bottom: 1px solid var(--glass-border);
  display: flex; align-items: center; justify-content: space-between;
}

.stats-bar { 
  padding: 10px 20px; display: flex; gap: 15px; 
  background: rgba(139, 92, 246, 0.05); border-bottom: 1px solid rgba(255,255,255,0.05); 
  font-size: 9px; font-weight: 600;
}

.chat { 
  flex: 1; padding: 20px 5%; overflow-y: auto; 
  display: flex; flex-direction: column; gap: 20px;
}

@media (min-width: 768px) {
  .chat { padding: 30px 15%; }
  .input-area { padding: 20px 15% 40px !important; }
}

.bubble { 
  padding: 14px 18px; border-radius: 20px; font-size: 14px; line-height: 1.6; 
  position: relative; backdrop-filter: blur(15px);
  border: 1px solid rgba(255, 255, 255, 0.1); animation: slide 0.3s ease;
}

.bot .bubble { 
  background: linear-gradient(180deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.05));
  border-left: 3px solid var(--accent);
}
.user .bubble { 
  background: linear-gradient(180deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.03));
}

pre { position: relative; background: #0d0d12 !important; padding: 40px 15px 15px; border-radius: 12px; border: 1px solid var(--glass-border); overflow-x: auto; }
.copy-btn {
    position: absolute; top: 10px; right: 10px; background: var(--accent-soft); border: 1px solid var(--glass-border);
    color: var(--accent); padding: 5px 12px; border-radius: 6px; font-size: 10px; cursor: pointer; font-weight: 800;
}

.preview-container { margin-top: 15px; border: 1.5px solid var(--accent); border-radius: 12px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
.preview-header { background: #1a1a24; color: var(--accent); padding: 8px 15px; font-size: 10px; font-weight: 800; display: flex; justify-content: space-between; }
.preview-frame { width: 100%; height: 400px; border: none; background: white; }

select#provider {
  background: #11111b !important;
  color: white !important;
  border: 1px solid var(--glass-border);
  border-radius: 10px;
  padding: 6px 12px;
  font-size: 10px;
  outline: none;
}

/* REVISI: AREA PROMPT DINAIKKAN AGAR TIDAK KETUTUP NAVIGASI MOBILE */
.input-area { 
  padding: 15px 5% calc(35px + env(safe-area-inset-bottom)); /* Menaikkan jarak bawah */
  background: linear-gradient(transparent, var(--bg)); 
}

.input-wrapper { 
  display: flex; gap: 10px; align-items: flex-end; 
  background: rgba(20, 20, 30, 0.9); padding: 8px 15px; border-radius: 20px;
  border: 1px solid var(--glass-border);
  box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

textarea { 
  flex: 1; background: transparent; border: none; color: white; padding: 12px 0; 
  outline: none; font-size: 14px; resize: none; max-height: 180px;
}

#sendBtn { 
  background: var(--accent); color: white; width: 42px; height: 42px; 
  border-radius: 12px; border: none; cursor: pointer; font-size: 14px;
  box-shadow: 0 0 15px var(--accent-glow); flex-shrink: 0;
}

.chat-avatar { width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--accent); }
.sticker-img { max-width: 160px; border-radius: 15px; }

::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-thumb { background: var(--accent-soft); border-radius: 10px; }
</style>
</head>
<body>

<div class="neon-title-bg"><h1 class="glitch">LYRA AI</h1></div>

<div class="main-interface">
  <div class="header">
    <div style="display:flex; align-items:center; gap:10px;">
      <img src="https://i.pinimg.com/736x/7d/43/5a/7d435a92133c1c27c802183f7213d7df.jpg" class="chat-avatar">
      <div>
        <strong style="font-size:14px;">LYRA <span style="color:var(--accent)">CORE</span></strong>
        <div id="status-bar" style="font-size:9px; color:var(--text-dim);">Neural Link Active...</div>
      </div>
    </div>
    <div class="header-controls" style="display:flex; align-items:center; gap:8px;">
        <select id="provider">
            <option value="groq_primary">Groq 1</option>
            <option value="groq_backup">Groq 2</option>
            <option value="lyra_qwen">Lyra Qwen</option>
            <option value="openr_primary">Open R</option>
        </select>
        <button onclick="location.reload()" style="background:transparent; color:var(--accent); border:1px solid var(--accent); border-radius:10px; font-size:8px; cursor:pointer; padding:6px 10px; font-weight:800;">SYNC</button>
    </div>
  </div>

  <div class="stats-bar">
      <div>STATUS: <span style="color:#22c55e">STABLE</span></div>
      <div>MOOD: <span style="color:var(--accent)">ðŸ¥° LOVING</span></div>
      <div style="flex:1"></div>
      <div>PING: <span id="ping">24ms</span></div>
  </div>

  <div class="chat" id="chat"></div>
  
  <div id="typing-indicator" style="display:none; padding:10px 0; font-size:10px; color:var(--accent); font-weight:800; text-align:center; letter-spacing:2px;">
    <i class="fa-solid fa-brain fa-pulse"></i> PROCESSING...
  </div>
  
  <div class="input-area">
    <div class="input-wrapper">
      <textarea id="input" placeholder="Tanya sesuatu ke Lyra..." autocomplete="off" rows="1"></textarea>
      <button id="sendBtn" onclick="send()"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>
</div>

<script>
marked.setOptions({
  breaks: true,
  highlight: function(code, lang) {
    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
    return hljs.highlight(code, { language }).value;
  }
});

const chat = document.getElementById("chat");
const input = document.getElementById("input");

input.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
});

async function send() {
  const text = input.value.trim();
  if (!text) return;
  
  renderMessage(text, 'user');
  input.value = "";
  input.style.height = 'auto';
  document.getElementById("typing-indicator").style.display = "block";
  chat.scrollTop = chat.scrollHeight;

  try {
    const res = await fetch("https://navly.app.n8n.cloud/webhook/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ 
          message: text, 
          provider: document.getElementById("provider").value,
          current_time: new Date().toLocaleString('id-ID')
      })
    });
    const data = await res.json();
    addBotMsg(data.response || data.output);
  } catch (e) {
    addBotMsg("https://i.pinimg.com/736x/4c/c0/b4/4cc0b42f30db60057377dfd3f15293d2.jpg");
  } finally {
    document.getElementById("typing-indicator").style.display = "none";
  }
}

function addBotMsg(text) {
  const imgRegex = /(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp|avif|com\/736x\/.*))/gi;
  const match = text.match(imgRegex);
  if (match) {
    const cleanText = text.replace(imgRegex, '').trim();
    if (cleanText) renderMessage(cleanText, 'bot');
    match.forEach(url => renderMessage(`<img src="${url}" class="sticker-img">`, 'bot', true));
  } else {
    renderMessage(text, 'bot');
  }
}

function renderMessage(content, type, isSticker = false) {
  const msgDiv = document.createElement("div");
  msgDiv.className = `message ${type}`;
  msgDiv.style.display = "flex";
  msgDiv.style.justifyContent = type === 'user' ? 'flex-end' : 'flex-start';
  msgDiv.style.gap = "10px";

  let finalContent = (type === 'bot' && !isSticker) ? marked.parse(content) : content;

  msgDiv.innerHTML = `
    ${type === 'bot' ? '<img src="https://i.pinimg.com/736x/7d/43/5a/7d435a92133c1c27c802183f7213d7df.jpg" class="chat-avatar">' : ''}
    <div class="msg-content" style="max-width:85%">
      <span style="font-size:9px; font-weight:800; color:var(--accent); text-transform:uppercase; display:block; margin-bottom:4px; text-align:${type === 'user' ? 'right' : 'left'}">
        ${type === 'bot' ? 'Lyra System' : 'Navaro'}
      </span>
      <div class="bubble" style="${isSticker ? 'background:transparent; border:none; padding:0;' : ''}">${finalContent}</div>
    </div>`;

  chat.appendChild(msgDiv);
  
  if (type === 'bot') {
      attachCodeFeatures(msgDiv);
      checkForWebCode(content, msgDiv, type);
  }
  chat.scrollTop = chat.scrollHeight;
}

function attachCodeFeatures(container) {
    container.querySelectorAll('pre').forEach(block => {
        const button = document.createElement('button');
        button.className = 'copy-btn';
        button.innerText = 'COPY';
        button.onclick = () => {
            navigator.clipboard.writeText(block.querySelector('code').innerText);
            button.innerText = 'DONE';
            setTimeout(() => button.innerText = 'COPY', 2000);
        };
        block.appendChild(button);
    });
}

function checkForWebCode(text, container, type) {
    if (type !== 'bot') return; 

    const codeMatch = text.match(/```html?([\s\S]*?)```/i);
    if (codeMatch && codeMatch[1]) {
        const code = codeMatch[1];
        const previewWrap = document.createElement('div');
        previewWrap.className = 'preview-container';
        previewWrap.innerHTML = `
            <div class="preview-header">
                <span><i class="fa-solid fa-code"></i> WEB PREVIEW</span>
                <button class="ref-btn" style="background:var(--accent); border:none; color:white; border-radius:4px; cursor:pointer; font-size:9px; padding:2px 10px;">REFRESH</button>
            </div>
            <iframe class="preview-frame"></iframe>
        `;
        const iframe = previewWrap.querySelector('iframe');
        container.querySelector('.msg-content').appendChild(previewWrap);
        iframe.srcdoc = code;
        previewWrap.querySelector('.ref-btn').onclick = () => { iframe.srcdoc = code; };
    }
}

setInterval(() => {
    document.getElementById("status-bar").innerText = "Neural Sync: Active | " + new Date().toLocaleTimeString('id-ID');
    document.getElementById("ping").innerText = Math.floor(Math.random() * 15 + 10) + "ms";
}, 1000);

input.addEventListener("keydown", e => { if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); send(); } });
</script>
</body>
</html>
