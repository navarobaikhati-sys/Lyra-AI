<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Lyra AI â€¢ Neural Interface</title>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #030303;
  --accent: #3b82f6; 
  --accent-glow: rgba(59, 130, 246, 0.6);
  --glass: rgba(255, 255, 255, 0.02);
  --glass-border: rgba(255, 255, 255, 0.08);
  --text-main: #ffffff;
  --text-dim: #94a3b8;
}

[data-theme="night"] {
  --accent: #8b5cf6;
  --accent-glow: rgba(139, 92, 246, 0.6);
}

* { box-sizing: border-box; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

body {
  margin: 0; padding: 0; height: 100dvh;
  background: radial-gradient(circle at 50% -20%, var(--accent-glow), var(--bg) 90%);
  color: var(--text-main); font-family: 'Plus Jakarta Sans', sans-serif;
  display: flex; justify-content: center; align-items: center; overflow: hidden;
}

.app-container {
  width: 100%; height: 100%; background: var(--glass);
  backdrop-filter: blur(40px); display: flex; flex-direction: column;
  position: relative; overflow: hidden;
}

@media (min-width: 768px) {
  .app-container { width: 95vw; max-width: 1000px; height: 90vh; border: 1px solid var(--glass-border); border-radius: 32px; }
}

.neon-title-bg {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  z-index: 0; text-align: center; pointer-events: none; width: 100%;
}
.neon-title-bg h1 {
  font-size: clamp(60px, 20vw, 160px); font-weight: 900; margin: 0;
  background: linear-gradient(to bottom, rgba(255,255,255,0.8) 20%, var(--accent) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  filter: drop-shadow(0 0 25px var(--accent-glow));
  letter-spacing: -2px; opacity: 0.4;
}

.header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 15px; background: rgba(0,0,0,0.7); border-bottom: 1px solid var(--glass-border); z-index: 10;
}

.chat { flex: 1; padding: 20px; overflow-y: auto; z-index: 5; display: flex; flex-direction: column; gap: 12px; background: transparent; }

.message { display: flex; gap: 10px; width: 100%; z-index: 6; }
.message.bot { align-items: flex-start; }
.message.user { justify-content: flex-end; align-items: flex-start; }

.chat-avatar { width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--accent); object-fit: cover; }
.msg-content { display: flex; flex-direction: column; max-width: 80%; }

.msg-author { font-size: 10px; font-weight: 800; color: var(--accent); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
.user .msg-author { align-self: flex-end; color: #fff; opacity: 0.7; }

.bubble { padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.6; white-space: pre-wrap; position: relative; }
.bot .bubble { background: rgba(255,255,255,0.08); border: 1px solid var(--glass-border); border-top-left-radius: 2px; backdrop-filter: blur(12px); }
.user .bubble { background: var(--accent); border-top-right-radius: 2px; box-shadow: 0 5px 15px var(--accent-glow); color: white; }

.sticker-img { max-width: 180px; border-radius: 12px; display: block; margin-top: 5px; }

/* REVISED PREVIEW BOX */
#preview-container {
  display: none; padding: 10px 15px; background: rgba(0,0,0,0.8);
  border-top: 1px solid var(--glass-border);
}
#img-preview {
  width: 60px; height: 60px; border-radius: 8px; border: 1px solid var(--accent); object-fit: cover;
}

#typing-indicator { display: none; font-size: 10px; font-weight: 800; color: var(--accent); padding: 0 20px 10px; text-transform: uppercase; letter-spacing: 2px; animation: pulse 1.5s infinite; }
@keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }

.input-area { background: rgba(0,0,0,0.9); border-top: 1px solid var(--glass-border); z-index: 20; }
.input-wrapper { display: flex; padding: 12px; align-items: center; gap: 8px; }
select { background: #111; color: #fff; border: none; padding: 8px; font-size: 10px; border-radius: 10px; width: 90px; outline: none; }
input { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 14px; color: white; padding: 10px 15px; outline: none; font-size: 14px; }
#sendBtn { background: var(--accent); border: none; color: white; padding: 10px 20px; border-radius: 14px; font-weight: 800; cursor: pointer; }

#status-bar { font-size: 10px; color: var(--accent); font-weight: 800; }
.btn-reset { background: transparent; color: var(--text-dim); border: 1px solid var(--glass-border); padding: 5px 10px; border-radius: 8px; font-size: 9px; font-weight: 700; cursor: pointer; }
</style>
</head>
<body>

<div class="app-container" id="main-frame">
  <div class="neon-title-bg"><h1>LYRA AI</h1></div>

  <div class="header">
    <div style="display:flex; align-items:center; gap:10px;">
      <img src="https://i.pinimg.com/736x/7d/43/5a/7d435a92133c1c27c802183f7213d7df.jpg" width="30" style="border-radius:8px; border: 1px solid var(--accent);">
      <div>
        <strong style="font-size:13px;">Lyra Interface</strong><br>
        <span id="status-bar">Syncing...</span>
      </div>
    </div>
    <div style="display:flex; gap:8px;">
        <select id="provider">
            <option value="groq_primary">Groq 1</option>
            <option value="groq_backup">Groq 2</option>
            <option value="openr_primary">OpenR 1</option>
            <option value="openr_backup">OpenR 2</option>
        </select>
        <button class="btn-reset" onclick="location.reload()">RESET</button>
    </div>
  </div>

  <div class="chat" id="chat"></div>
  <div id="typing-indicator">Lyra is thinking...</div>
  
  <div class="input-area">
    <div id="preview-container">
        <img id="img-preview" src="">
    </div>
    <div class="input-wrapper">
      <input id="input" placeholder="Tulis pesan atau paste link foto..." autocomplete="off">
      <button id="sendBtn" onclick="send()">Send</button>
    </div>
  </div>
</div>

<script>
marked.setOptions({ breaks: true, gfm: true });
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const previewContainer = document.getElementById("preview-container");
const imgPreview = document.getElementById("img-preview");
const typingIndicator = document.getElementById("typing-indicator");
const mainFrame = document.getElementById("main-frame");
const statusBar = document.getElementById("status-bar");

function syncTime() {
    const now = new Date();
    const hour = now.getHours();
    if (hour >= 18 || hour < 6) mainFrame.setAttribute('data-theme', 'night');
    else mainFrame.removeAttribute('data-theme');
    statusBar.innerText = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
}
setInterval(syncTime, 1000); syncTime();

// DETEKSI LINK UNTUK PREVIEW (SUPPORT PINTEREST)
input.addEventListener('input', () => {
    const text = input.value;
    const imgRegex = /(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp|avif|com\/736x\/.*))/gi;
    const match = text.match(imgRegex);
    if (match) {
        imgPreview.src = match[0];
        previewContainer.style.display = 'block';
    } else {
        previewContainer.style.display = 'none';
    }
});

async function send() {
  const text = input.value.trim();
  if (!text) return;
  
  addMsg(text, 'user');
  input.value = "";
  previewContainer.style.display = 'none';
  typingIndicator.style.display = "block";
  chat.scrollTop = chat.scrollHeight;

  const timeNow = new Date().toLocaleString('id-ID', { 
    timeZone: 'Asia/Jakarta', weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  });

  try {
    const res = await fetch("https://navly.app.n8n.cloud/webhook/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: text, provider: document.getElementById("provider").value, current_time: timeNow })
    });
    const data = await res.json();
    addMsg(data.response || data.output, 'bot');
  } catch (e) {
    addMsg("https://i.pinimg.com/736x/4c/c0/b4/4cc0b42f30db60057377dfd3f15293d2.jpg", 'bot');
  } finally {
    typingIndicator.style.display = "none";
  }
}

function addMsg(text, type) {
  const imgRegex = /(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp|avif|com\/736x\/.*))/gi;
  const match = text.match(imgRegex);

  if (type === 'bot' && match) {
    const cleanText = text.replace(imgRegex, '').trim();
    if (cleanText) renderBubble(cleanText, type, false);
    match.forEach(url => {
      renderBubble(`<img src="${url}" class="sticker-img" onerror="this.style.display='none'">`, type, true);
    });
  } else {
    renderBubble(text, type, false);
  }
}

function renderBubble(content, type, isSticker) {
  const msgDiv = document.createElement("div");
  msgDiv.className = `message ${type}`;
  const finalContent = (type === 'bot' && !isSticker) ? marked.parse(content) : content;

  msgDiv.innerHTML = `
    ${type === 'bot' ? '<img src="https://i.pinimg.com/736x/7d/43/5a/7d435a92133c1c27c802183f7213d7df.jpg" class="chat-avatar">' : ''}
    <div class="msg-content">
      <span class="msg-author">${type === 'bot' ? 'Lyra AI' : 'Navaro'}</span>
      <div class="bubble" style="${isSticker ? 'background:transparent; border:none; padding:0; box-shadow:none;' : ''}">${finalContent}</div>
    </div>`;

  chat.appendChild(msgDiv);
  chat.scrollTop = chat.scrollHeight;
}

input.addEventListener("keydown", e => { if(e.key === "Enter") send(); });
</script>
</body>
</html>
